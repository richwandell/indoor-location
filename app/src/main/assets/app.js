var registry={classes:{},objs:{},debug:!0,super_debug:!1,console:{debug:function(a){arguments.callee.caller.__name=a,registry.debug&&console.debug(a)},superDebug:function(a){arguments.callee.caller.__name=a,registry.super_debug&&console.debug(a)}}};!function(a,b){var c=b.classes,d=(c.InvalidArgumentException,b.console.debug),e=function(a){d("ContextMenu"),this.container=a,"function"==typeof require&&(this.gui=require("nw.gui"),this.setupMenu())};e.prototype.setupMenu=function(){var b=this.gui,c=b.Window.get(),d=this,e=new b.Menu({type:"menubar"}),f=new b.Menu;f.append(new b.MenuItem({label:"Import Floorplan",click:function(){alert("import floorplan")}})),f.append(new b.MenuItem({label:"Export Floorplan",click:function(){alert("export floorplan")}})),e.createMacBuiltin("your-app-name",{hideEdit:!0,hideWindow:!0}),e.append(new b.MenuItem({label:"File",submenu:f})),c.menu=e;var g=new b.Menu;g.append(new b.MenuItem({label:"Clear Selection",click:function(a){d.container.grid.clearMultiSelection(a)}})),a("#builder_canvas_overlay").on("contextmenu",function(a){return a.preventDefault(),g.popup(a.clientX,a.clientY),!1}),this.menu=g,this.win=c,this.menubar=e},c.ContextMenu=e}(jQuery,registry),function(a){function b(a){this.message=a,"undefined"!=typeof arguments.callee.caller.caller.__name&&(this.caller=arguments.callee.caller.caller.__name)}a.InvalidArgumentException=b}(registry.classes),function(a,b){var c=b.classes,d=c.InvalidArgumentException,e=b.console.debug,f=function(a){e("Db.constructor"),this.container=a,this.databaseVersion=11,this.database_version=0,this.needsSettings=!1,this.androidFpDatabase=[],this.allFpIds=[],this.container.android||this.requestDatabase()};f.prototype.addFloorPlan=function(a){return e("Db.addFloorPlan"),"undefined"!=typeof a.id&&void(this.allFpIds.indexOf(a.id)>-1?this.androidFpDatabase[this.allFpIds.indexOf(a.id)]=a:(this.androidFpDatabase.push(a),this.allFpIds.push(a.id)))},f.prototype.updateDatabaseVersion=function(a){var b=this,c=b.database.transaction(["settings"],"readwrite").objectStore("settings"),d=c.get(1);d.onsuccess=function(d){var e=d.target.result;e.database_version=a,b.database_version=a,c.put(e)}},f.prototype.requestDatabase=function(a){e("Db.requestDatabase");var b=this,c=window.indexedDB.open("BuilderDatabase",this.databaseVersion);c.onupgradeneeded=function(a){e("Db.onupgradeneeded"),b.database=a.target.result,b.database.objectStoreNames.contains("layout_images")||b.database.createObjectStore("layout_images",{keyPath:"id"}),b.database.objectStoreNames.contains("settings")||(b.database.createObjectStore("settings",{keyPath:"id",autoIncrement:!0}),b.needsSettings=!0)},c.onsuccess=function(a){if(e("Db.onsuccess"),b.database=a.target.result,b.needsSettings){var c=b.database.transaction(["settings"],"readwrite").objectStore("settings").add({database_version:b.database_version});c.onsuccess=function(a){b.syncWithServer()}}else b.syncWithServer()}},f.prototype.syncWithServer=function(){e("Db.syncWithServer");var a=this;this.getServerVersion(function(b){var c=a.database.transaction(["settings"],"readwrite").objectStore("settings"),d=c.get(1);d.onsuccess=function(c){var d=c.target.result.database_version+a.databaseVersion;a.database_version=c.target.result.database_version;var e="undefined"!=typeof b.databaseVersion?parseInt(b.databaseVersion):d;d==e?a.reloadFromDb():e<d?a.sendUpdates():(a.updateDatabaseVersion(e-a.databaseVersion),a.getUpdates())}})},f.prototype.getUpdates=function(){e("Db.getUpdates");var b=this;a.ajax({url:"http://localhost:8888/rest/floorplans",method:"get",dataType:"json",success:function(c){var d=c.length,e=0;a.each(c,function(c,f){var g=f.layout_image;g.id=String(g.id),g.hgrid_spaces=parseInt(g.hgrid_spaces),g.vgrid_spaces=parseInt(g.vgrid_spaces),a.each(g.grid,function(b,c){""===c&&delete g.grid[b],a.each(c,function(a,c){""===c&&delete g.grid[b][a]})});var h=b.database.transaction(["layout_images"],"readwrite").objectStore("layout_images").add(g);h.onsuccess=function(){e++,e>=d&&b.reloadFromDb()},h.onerror=function(){e++,e>=d&&b.reloadFromDb()}})}})},f.prototype.getServerVersion=function(b){e("Db.getServerVersion");var c=this;a.ajax({url:"http://localhost:8888/rest/databaseVersion",method:"get",dataType:"json",success:function(a){b.apply(c,arguments)},error:function(a){c.reloadFromDb()}})},f.prototype.sendUpdates=function(){e("Db.sendUpdates");var b=this,c=b.database.transaction(["layout_images"],"readwrite").objectStore("layout_images").getAll();c.onsuccess=function(c){a.ajax({url:"http://localhost:8888/rest/updateDatabase",method:"post",dataType:"json",data:{databaseVersion:b.databaseVersion+b.database_version,layout_images:c.target.result},success:function(a){a.success&&b.reloadFromDb()}})}},f.prototype.sendOneUpdate=function(b){var c=this;a.ajax({url:"http://localhost:8888/rest/updateDatabase",method:"post",dataType:"json",data:{databaseVersion:c.databaseVersion+c.database_version,layout_images:[b]},success:function(a){a.success&&console.log(a)}})},f.prototype.addLayoutImage=function(a,b){e("Db.addLayoutImage");var c=this.database.transaction(["layout_images"],"readwrite").objectStore("layout_images").add(a),d=this;c.onsuccess=function(a){b.apply(d,arguments)}},f.prototype.reloadFromDb=function(b){e("Db.reloadFromDb"),isNaN(b)&&(b=null);var c=this;a("#builder_select_existing").html("");var d=this.database.transaction(["layout_images"],"readwrite").objectStore("layout_images").getAll();d.onsuccess=function(a){c.container.layout.resetFromDb(a,b)}},f.prototype.loadFloorplan=function(a,b){e("Db.loadFloorplan");var c=this;if(this.container.android){var d=this.allFpIds.indexOf(a);if(d>-1){var f=this.androidFpDatabase[d].layout_image,g={target:{result:f}};return b.apply(c,[g])}}else{var h=this.database.transaction(["layout_images"],"readwrite").objectStore("layout_images").get(String(a));h.onsuccess=function(a){b.apply(c,arguments)}}},f.prototype.deleteExisting=function(b){e("Db.deleteExisting");var c=a("#builder_select_existing").val(),d=this.database.transaction(["layout_images"],"readwrite").objectStore("layout_images").delete(c),f=this;d.onsuccess=function(a){f.reloadFromDb()}},f.prototype.saveFloorplan=function(b){if(e("Db.saveFloorplan"),"object"!=typeof b)throw new d("saveFloorplan requires an object parameter");if("string"!=typeof b.id)throw new d("saveFloorplan missing id");var c=this.database.transaction(["layout_images"],"readwrite").objectStore("layout_images"),f=c.get(b.id),g=this;f.onsuccess=function(d){var e=d.target.result;a.each(b,function(a,b){e[a]=b});var f=c.put(e);f.onsuccess=function(a){var b=g.database.transaction(["settings"],"readwrite").objectStore("settings"),c=b.get(1);c.onsuccess=function(a){var c=a.target.result;c.database_version++,g.database_version++,b.put(c),g.sendOneUpdate(e)}}}},c.Db=f}(jQuery,registry),function(a,b){var c=b.classes,d=c.InvalidArgumentException,e=b.console.debug,f=b.console.superDebug,g=function(b){e(arguments.callee.name),this.container=b,this.canvas=a("#builder_canvas")[0],this.canvas_context=this.canvas.getContext("2d"),this.overlay=a("#builder_canvas_overlay")[0],this.overlay_context=this.overlay.getContext("2d"),this.image_width=0,this.image_height=0,this.image=null,this.image_name="",this.full_grid=[],this.multi_selected_grid=[],this.selected_grid=[],this.hover_grid=[],this.fp_grid=[],this.vgrid_spaces=parseInt(a("#builder_vgrid_spaces").val()),this.hgrid_spaces=parseInt(a("#builder_hgrid_spaces").val()),this.grid_color=a("#builder_grid_color").val(),this.grid_lines_enabled=!0,this.mouse_down=!1,this.m_x_start=!1,this.m_y_start=!1,this.touch_cx=!1,this.touch_cy=!1};g.prototype.overlayTouchEnd=function(a){if(this.touch_cx&&this.touch_cy){var b=this.clickCanvas(this.touch_cx,this.touch_cy);this.container.android&&Android.setSpace(b[0],b[1],this.container.layout.floorplanId)}},g.prototype.overlayTouchMove=function(a){this.touch_cx=!1,this.touch_cy=!1},g.prototype.overlayTouchStart=function(a){var b=(this.canvas.getContext("2d"),this.canvas.getBoundingClientRect()),c=a.touches[0],d=c.clientX,e=c.clientY,f=d-b.left,g=e-b.top;this.touch_cx=f,this.touch_cy=g},g.prototype.getFullGrid=function(){return this.full_grid},g.prototype.getImageName=function(){return this.image_name},g.prototype.getOverlay=function(){return this.overlay},g.prototype.getMultiSelectedGrid=function(){return this.multi_selected_grid},g.prototype.getHGridSpaces=function(){return this.hgrid_spaces},g.prototype.getVGridSpaces=function(){return this.vgrid_spaces},g.prototype.getGridColor=function(){return this.grid_color},g.prototype.setGridColor=function(b){e("Grid.setGridColor"),this.grid_color=b,a("#builder_grid_color").val(b)},g.prototype.clearMultiSelection=function(a){e("Grid.clearMultiSelection"),this.multi_selected_grid=[],this.selected_grid=[],this.redraw()},g.prototype.redraw=function(){e("Grid.redraw"),this.drawGrid()},g.prototype.resetZoom=function(){e("Grid.resetZoom");var b=this.canvas.width,c=this.canvas.height,d={width:parseInt(b)+"px",height:parseInt(c)+"px"};a(this.canvas).css(d),a(this.overlay).css(d)},g.prototype.setGridVars=function(b){if(e("Grid.setGridVars"),"object"==typeof b){var c=this;return a.each(b,function(a,b){"undefined"!=typeof c[a]&&(c[a]=b)}),!0}throw new d("setGridVars requires an object parameter")},g.prototype.setHandVSpace=function(b,c){e("Grid.setHandVSpace"),this.hgrid_spaces=b,this.vgrid_spaces=c,a("#builder_hgrid_spaces").val(b),a("#builder_vgrid_spaces").val(c)},g.prototype.setHoverGrid=function(a,b,c){e(arguments.callee.name),this.hover_grid[a]||(this.hover_grid[a]=[]),this.hover_grid[a][b]=c},g.prototype.zoomIn=function(b){e("Grid.zoomIn");var c=a(this.canvas).css("width"),d=a(this.canvas).css("height"),f={width:1.1*parseInt(c)+"px",height:1.1*parseInt(d)+"px"};a(this.canvas).css(f),a(this.overlay).css(f)},g.prototype.zoomOut=function(b){e("Grid.zoomOut");var c=a(this.canvas).css("width"),d=a(this.canvas).css("height"),f={width:.9*parseInt(c)+"px",height:.9*parseInt(d)+"px"};a(this.canvas).css(f),a(this.overlay).css(f)},g.prototype.overlayClicked=function(a){e("Grid.overlayClicked");var b=this.getCanvasMouseXandY(a);this.clickCanvas(b[0],b[1])},g.prototype.overlayMouseDown=function(b){f("Grid.overlayMouseDown"),this.mouse_down=!0;var c=this.getCanvasMouseXandY(b);this.m_x_start=c[0],this.m_y_start=c[1],a(this.canvas).css("opacity",".7"),a(this.overlay).css("opacity","1")},g.prototype.overlayMouseUp=function(b){f("Grid.overlayMouseUp"),this.mouse_down=!1,a(this.canvas).css("opacity","1"),a(this.overlay).css("opacity",".5");var c,d,e=this.getCanvasMouseXandY(b),g=this.getGridXandY(this.m_x_start,this.m_y_start),h=this.getGridXandY(e[0],e[1]);g[0]>h[0]?(c=h[0],d=g[0]):(c=g[0],d=h[0]);var i,j;g[1]>h[1]?(i=h[1],j=g[1]):(i=g[1],j=h[1]);for(var k=c;k<=d;k++)for(var l=i;l<=j;l++)this.multi_selected_grid[k]||(this.multi_selected_grid[k]=[]),this.multi_selected_grid[k][l]=""},g.prototype.overlayMouseMove=function(a){if(f("Grid.overlayMouseMove"),this.mouse_down){var b=this.getCanvasMouseXandY(a);this.drawBox(this.m_x_start,this.m_y_start,b[0],b[1])}},g.prototype.drawBox=function(a,b,c,d){e("Grid.drawBox"),this.drawGrid();var f=c-a,g=d-b;this.overlay_context.rect(a,b,f,g),this.overlay_context.stroke()},g.prototype.getCanvasMouseXandY=function(a){e("Grid.getCanvasMouseXandY");var b=this.canvas_context,c=b.canvas.width,d=b.canvas.height,f=this.canvas.getBoundingClientRect(),g=a.clientX,h=a.clientY,i=(g-f.left)/(f.right-f.left)*c,j=(h-f.top)/(f.bottom-f.top)*d;return[i,j]},g.prototype.clickCanvas=function(b,c){e("Grid.clickCanvas");var d=this.getGridXandY(b,c),f=d[0],g=d[1],h=a("#builder_selected_box_name").val();return this.full_grid[f]&&(this.full_grid[f][g]||""===this.full_grid[f][g])&&(h=this.full_grid[f][g]),this.container.layout.setSelectedGrid(f,g,h),this.redraw(),[f,g]},g.prototype.getGridXandY=function(a,b){var c=this.canvas_context,d=c.canvas.width,e=c.canvas.height,f=this.hgrid_spaces,g=this.vgrid_spaces,h=d/f,i=Math.floor(a/h),j=e/g,k=Math.floor(b/j);return[i,k]},g.prototype.drawGrid=function(){e("Grid.drawGrid");var a=this.canvas_context;a.canvas.width=this.image_width,a.canvas.height=this.image_height,a.drawImage(this.image,1,1,this.image_width,this.image_height);var b=this.overlay_context;b.canvas.width=this.image_width,b.canvas.height=this.image_height;var c=a.canvas.width,d=a.canvas.height,f=this.hgrid_spaces,g=this.vgrid_spaces,h=0,i=this.grid_color,j=this.full_grid,k=this.selected_grid,l=this.hover_grid,m=this.multi_selected_grid,n=this.fp_grid,o=this.container.android;if(this.grid_lines_enabled)for(h=0;h<g;h++)a.moveTo(0,d/g*h),a.lineTo(c,d/g*h),a.strokeStyle=i,a.stroke();for(h=0;h<f;h++){if(this.grid_lines_enabled&&(a.moveTo(c/f*h,0),a.lineTo(c/f*h,d),a.strokeStyle=i,a.stroke()),!o&&(j[h]||""===j[h]))for(var p=0;p<j[h].length;p++)(j[h][p]||""===j[h][p])&&(b.fillStyle="red",b.fillRect(c/f*h,d/g*p,c/f,d/g));if(o&&(n[h]||""===n[h]))for(var p=0;p<n[h].length;p++)(n[h][p]||""===n[h][p])&&(b.fillStyle="red",b.fillRect(c/f*h,d/g*p,c/f,d/g));if(k[h]||""===k[h])for(var p=0;p<k[h].length;p++)(k[h][p]||""===k[h][p])&&(a.fillStyle="green",a.fillRect(c/f*h,d/g*p,c/f,d/g));if(!o&&(l[h]||""===l[h]))for(var p=0;p<l[h].length;p++)(l[h][p]||""===l[h][p])&&(b.fillStyle="gold",b.fillRect(c/f*h,d/g*p,c/f,d/g));if(!o&&(m[h]||""===m[h]))for(var p=0;p<m[h].length;p++)(m[h][p]||""===m[h][p])&&(b.fillStyle="blue",b.fillRect(c/f*h,d/g*p,c/f,d/g))}},c.Grid=g}(jQuery,registry),function(a,b,c){var d=b.console.debug,e=function(b){d("LayoutManager.constructor"),this.container=b,this.floorplanId=!1;var c=a(window).width(),e=a(window).height(),f=a("#top_row").height();a("#builder_canvas_container").css("maxWidth",c),a("#builder_canvas_container, #builder_container_container").height(e-f);var g=!1;a(window).on({mousedown:function(b){a(b.target).is("#resize_handle")&&(g=!0)},mousemove:function(b){if(g){var c=b.clientX;a("#builder_canvas_container_container").width(c-25);var d=a(window).width();a("#builder_container_container").width(d-c-20)}},mouseup:function(){g=!1}});var h=!1;a(window).on({mousedown:function(b){a(b.target).is("#resize_handle_top")&&(h=!0)},mousemove:function(b){if(h){var c=b.clientY+10;a("#top_row").height(c);var d=a(window).height();a("#builder_canvas_container, #builder_container_container").height(d-c)}},mouseup:function(){h=!1}}),a(window).resize(this.adjustLayout)};e.prototype.adjustLayout=function(){var b=a(window).width(),c=a(window).height(),d=a("#top_row").height();a("#builder_canvas_container").css("maxWidth",b),a("#builder_canvas_container, #builder_container_container").height(c-d)},e.prototype.setFloorplanName=function(b){d("LayoutManager.setFloorplanName"),b?(a("#top_row .page-header small").text(b),a("#builder_floorplan_name").val(b)):(a("#builder_floorplan_name").val(""),a("#top_row .page-header small").text(""))},e.prototype.resetFromDb=function(b,c){d("LayoutManager.resetFromDb"),a(b.target.result).each(function(b,c){a("#builder_select_existing").append("<option value='"+c.id+"'>"+c.name+"</option>")}),c&&a("#builder_select_existing").val(c),b.target.result.length>0&&this.displayFloorplan(a("#builder_select_existing").val())},e.prototype.displayFloorplan=function(a){d("LayoutManager.displayFloorplan");var b=this;b.floorplanId=a,this.container.db.loadFloorplan(a,function(a){b.setImageName(a.target.result.name),b.setFloorplanName(a.target.result.floorplanname),b.container.grid.setHandVSpace(a.target.result.hgrid_spaces,a.target.result.vgrid_spaces);var c=document.createElement("img");c.src=a.target.result.image,c.onload=function(a){b.imageLoaded(c)};var d="#a8fb8b";"undefined"!=typeof a.target.result.grid_color&&(d=a.target.result.grid_color),b.container.grid.setGridColor(d),b.container.grid.setGridVars({full_grid:a.target.result.grid}),b.drawFloorPlan()})},e.prototype.imageLoaded=function(a){d("LayoutManager.imageLoaded"),a&&this.container.grid.setGridVars({image:a,image_height:a.height,image_width:a.width}),this.container.grid.redraw(),this.container.grid.resetZoom()},e.prototype.setImageName=function(b){d("LayoutManager.setImageName"),this.container.grid.setGridVars({image_name:b}),a("#builder_table caption#builder_title").html(b)},e.prototype.imageChanged=function(a){d("LayoutManager.imageChanged");var b=a.target,c=new FileReader,e=this;c.onload=function(){var a=c.result,d=new Image;d.src=a,d.onload=function(){e.setImageName(b.files[0].name),e.container.db.addLayoutImage({id:md5(a),name:e.container.grid.getImageName(),image:a,grid:[],hgrid_spaces:e.container.grid.getHGridSpaces(),vgrid_spaces:e.container.grid.getVGridSpaces(),grid_color:e.container.grid.getGridColor()},e.container.db.reloadFromDb)}},c.readAsDataURL(b.files[0])},e.prototype.spacesChanged=function(b){d("LayoutManager.spacesChanged"),this.container.grid.setGridVars({hgrid_spaces:a("#builder_hgrid_spaces").val(),vgrid_spaces:a("#builder_vgrid_spaces").val()}),this.imageLoaded()},e.prototype.addSpace=function(b){d("LayoutManager.addSpace");for(var c=a("#builder_selected_box_name").val(),e=this.container.grid.getMultiSelectedGrid(),f=this.container.grid.getFullGrid(),g=0;g<e.length;g++)if(e[g]){f[g]||(f[g]=[]);for(var h=0;h<e[g].length;h++)(e[g][h]||""===e[g][h])&&(f[g][h]=c)}this.container.grid.setGridVars({full_grid:f,multi_selected_grid:[]}),this.container.grid.redraw(),this.drawFloorPlan()},e.prototype.drawFloorPlan=function(){d("LayoutManager.drawFloorPlan"),a("#builder_named_grid_spaces").html("");for(var b={},c=this.container.grid.getFullGrid(),e=0;e<c.length;e++)if(c[e])for(var f=0;f<c[e].length;f++)if(c[e][f]||""===c[e][f]){var g=c[e][f];""==g.trim()&&(g="no name"),b[g]||(b[g]=[]),b[g].push([e,f])}a.each(b,function(b,c){for(var d="<td class='bngs_name'>"+b+"</td>",e="<td><ul>",f=0;f<c.length;f++)e+="<li data-x='"+c[f][0]+"' data-y='"+c[f][1]+"'>X: "+c[f][0]+" Y: "+c[f][1]+"</li>";e+="</ul></td>",a("#builder_named_grid_spaces").append("<tr>"+d+e+"</tr>")})},e.prototype.selectGridFromList=function(b){d("LayoutManager.selectGridFromList");var c,e,f=a(b.currentTarget).find(".bngs_name").text();a.each(a(b.currentTarget).find("li"),function(b,d){c=a(d).data("x"),e=a(d).data("y")}),this.setSelectedGrid(c,e,f),this.container.grid.redraw()},e.prototype.setSelectedGrid=function(b,c,e){d("LayoutManager.setSelectedGrid");var f=[];f[b]=[],f[b][c]=e,this.container.grid.setGridVars({selected_grid:f}),a("#builder_selected_box").show(),a("#builder_selected_box_coords").html("x: "+b+" y: "+c),a("#builder_selected_box_name").val(e)},e.prototype.hoverGridFromList=function(b){d("LayoutManager.hoverGridFromList"),this.container.grid.setGridVars({hover_grid:[]});var c=this;a.each(a(b.currentTarget).find("li"),function(b,d){var e=a(d).data("x"),f=a(d).data("y");c.container.grid.setHoverGrid(e,f,name)}),this.container.grid.redraw()},e.prototype.removeHoverGridFromList=function(a){d("LayoutManager.removeHoverGridFromList"),this.container.grid.setGridVars({hover_grid:[]}),this.container.grid.redraw()},e.prototype.selectChanged=function(a){d("LayoutManager.selectChanged"),this.displayFloorplan(a.target.value)},e.prototype.toggleSpaceDisplay=function(b){d("LayoutManager.toggleSpaceDisplay"),a(b.currentTarget).toggleClass("builder_space_list_open")},e.prototype.saveFloorplan=function(){d("LayoutManager.saveFloorplan");var b=a("#builder_floorplan_name").val();this.setFloorplanName(b);var c=a("#builder_select_existing").val(),e=parseInt(a("#builder_hgrid_spaces").val()),f=parseInt(a("#builder_vgrid_spaces").val()),g=a("#builder_grid_color").val();this.container.db.saveFloorplan({id:c,name:this.container.grid.getImageName(),grid:this.container.grid.getFullGrid(),hgrid_spaces:e,vgrid_spaces:f,floorplanname:b,grid_color:g})},c.LayoutManager=e}(jQuery,registry,registry.classes),function(a,b,c,d){var e=b.console.debug,f=function(){e("Main.constructor"),this.android="undefined"!=typeof Android,this.grid=new c.Grid(this),this.db=new c.Db(this),this.layout=new c.LayoutManager(this),this.contextMenu=new c.ContextMenu(this),this.setupEvents(),"undefined"!=typeof process&&process.mainModule&&process.mainModule.exports.register(this)};f.prototype.setupEvents=function(){e("Main.setupEvents");var b=this;a("#builder_image_input").change(function(a){b.layout.imageChanged(a)}),a("#builder_select_existing").change(function(a){b.layout.selectChanged(a)}),a("#builder_vgrid_spaces, #builder_hgrid_spaces").change(function(a){b.layout.spacesChanged(a)});var c=a("#builder_named_grid_spaces");c.on("click","tr",function(a){b.layout.selectGridFromList(a)}),c.on("mouseenter","tr",function(a){b.layout.hoverGridFromList(a)}),c.on("mouseleave","tr",function(a){b.layout.removeHoverGridFromList(a)}),c.on("click","tr ul",function(a){b.layout.toggleSpaceDisplay(a)}),a("#save_floorplan").click(function(a){b.layout.saveFloorplan(a)}),a("#builder_add_spaces").click(function(a){b.layout.addSpace(a)}),a(".builder_zoom_in").click(function(a){b.grid.zoomIn(a)}),a(".builder_zoom_out").click(function(a){b.grid.zoomOut(a)}),a("#builder_grid_color").change(function(c){b.grid.setGridVars({grid_color:a("#builder_grid_color").val()}),b.grid.redraw(c)}),a(this.grid.getOverlay()).off(),a(this.grid.getOverlay()).on({mousedown:function(a){b.grid.overlayMouseDown(a)},mouseup:function(a){b.grid.overlayMouseUp(a)},mousemove:function(a){b.grid.overlayMouseMove(a)},click:function(a){b.grid.overlayClicked(a)},touchstart:function(a){b.grid.overlayTouchStart(a)},touchmove:function(a){b.grid.overlayTouchMove(a)},touchend:function(a){b.grid.overlayTouchEnd(a)}}),a("#builder_clear_selection").click(function(a){b.grid.clearMultiSelection(a)}),a("#builder_delete_existing").click(function(a){b.db.deleteExisting(a)}),a("#builder_download").click(function(a){b.downloadFloorplan(a)})},f.prototype.downloadFloorplan=function(b){e("Main.downloadFloorplan");var c=parseInt(a("#builder_select_existing").val());this.db.loadFloorplan(c,function(a){var b=a.target.result,c=document.createElement("a");c.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(JSON.stringify(b))),c.setAttribute("download","fplan-"+b.id+".json"),c.style.display="none",document.body.appendChild(c),c.click(),document.body.removeChild(c)})},f.prototype.loadFloorPlan=function(a){e("Main.loadFloorPlan"),this.android&&(this.floorPlan=JSON.parse(Android.getData2(Number(a))),this.db.addFloorPlan(this.floorPlan),this.layout.displayFloorplan(this.floorPlan.id))},c.Main=f,d.Main=[new f],window.loadFloorPlan=function(a){d.Main[0].loadFloorPlan(a)}}(jQuery,registry,registry.classes,registry.objs);
//# sourceMappingURL=app.map